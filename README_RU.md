# Проект Counter

## Описание

Этот проект реализует систему счетчика с использованием платы Arduino с Ethernet. Счетчик увеличивается на основе входных сигналов с пинов, а состояние передается по сети на сервер через HTTP-запросы. Система поддерживает сброс счетчика через HTTP и может отслеживать состояние до 20 входов. Она предназначена для управления операциями как через физические входы (например, кнопки или датчики), так и через удаленные команды.

---

## Особенности

- **Ethernet-соединение**: Использует Ethernet шилд для подключения Arduino к сети.
- **Управляющие входы**: Отслеживает до 20 управляющих пинов (в этой версии с A0 до A5).
- **Обработка состояния**: Отслеживает состояние каждого управляющего входа и считает количество его активаций.
- **Функция сброса**: Позволяет сбрасывать счетчики через веб-запрос.
- **Веб-интерфейс**: Предоставляет базовый веб-API для получения текущего состояния счетчиков и их сброса удаленно.
- **LED-уведомления**: Использует светодиоды для индикации состояния подключения и изменения состояния.

---

## Требования к оборудованию

- **Плата Arduino** (например, Arduino Uno)
- **Ethernet шилд** (совместимый с Arduino)
- **Светодиоды** для визуальных уведомлений
- **Кнопки или датчики**, подключенные к пинам A0 до A5 (или больше, если модифицировано)
- **Ethernet-кабель** (для проводного подключения к сети)

---

## Требования к ПО

- **Среда разработки Arduino IDE** (с установленными библиотеками для `SPI` и `Ethernet`)
- Базовые знания программирования для Arduino и сетевых технологий

---

## Настройка

### 1. Измените настройки устройства

Необходимо указать уникальный идентификатор устройства. Вы можете использовать MAC-адрес.

```cpp
String deviceId = "DE-AD-BE-EF-FE-ED";  // Измените это
byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED };  // Измените при необходимости
```

Дополнительно, настройте статический IP-адрес и параметры сервера API:

```cpp
IPAddress ip(192, 168, 1, 10); // Установите желаемый статический IP
char apiHost[20] = "192.168.1.20";  // Обновите адрес вашего API-сервера
String apiUri = "/api";  // Точка доступа API
String apiAppendParam = "&api_token=";  // Добавьте токен API, если нужно
```

### 2. Подключение проводки

- **Управляющие пины**: Подключите кнопки или датчики к пинам A0 до A5. Код обрабатывает эти пины как входные с подтягивающими резисторами.
- **Светодиоды**: Пины 8 и 9 используются для управления светодиодами уведомлений (красный и зеленый).

### 3. Загрузка кода

Загрузите код на вашу плату Arduino через Arduino IDE. После загрузки система инициализирует Ethernet-соединение и начнет отслеживание входных сигналов.

---

## Веб-API

### Получить статус счетчика

Отправьте GET-запрос на IP-адрес Arduino для получения текущего статуса:

```
GET /api?deviceId=DE-AD-BE-EF-FE-ED
```

Ответ (формат JSON):

```json
{
  "deviceId": "DE-AD-BE-EF-FE-ED",
  "deviceIP": "192.168.1.10",
  "allControlCount": 25,
  "controlCount": [ 5, 0, 8, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
}
```

### Сбросить счетчик

Вы можете сбросить счетчики с помощью следующего URL:

```
GET /api?reset&device_id=DE-AD-BE-EF-FE-ED
```

Это сбросит все счетчики и предоставит подтверждение.

---

## Индикация состояния с помощью светодиодов

- **Красный светодиод (пин 8)**:
  - Мигает, когда Ethernet-соединение инициализируется или восстанавливается.
- **Зеленый светодиод (пин 9)**:
  - Включается, когда кнопка нажата или датчик активирован, что сигнализирует об изменении состояния.

---

## Устранение неполадок

1. **Ethernet не подключается**:
   - Убедитесь, что Ethernet-щит правильно подключен, а кабель работает.
   - Проверьте, что статический IP-адрес не конфликтует с другими устройствами в вашей сети.
   
2. **Управляющие входы не срабатывают**:
   - Проверьте проводку для кнопок или датчиков.
   - Убедитесь, что пины правильно настроены в коде.

3. **Нет ответа от API**:
   - Убедитесь, что сервер по адресу `apiHost` работает и доступен.
   - Проверьте правильность конфигурации конечной точки API на сервере.

---

## Лицензия

Этот проект лицензирован под MIT License - см. файл [LICENSE](LICENSE) для подробностей.
